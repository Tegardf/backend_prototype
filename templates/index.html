<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>
	<form action="/submit" method="post">
		<p>
			<input type="file" name="datafile" size="40" id="image">
			<input type="hidden" name="value_base64" value="" id=base64_data>
			<br>
			<button>Submit</button>
		</p>
	</form>
	<div>
		<h4 id="output" style="color:black; position: relative;">base64 audio:</h4>
		<audio controls  loop autoplay>
			<source id="audio" src="" type="audio/wav">
			Your browser dose not Support the audio Tag
		</audio>
		<h4 id="note" style="color:black; position: relative;">{{audio_content}}</h4>
	</div>
	<div>
		<h4 id="text" style="color:black; position: relative;">teks: </h4>
		<h4 id="note" style="color:black; position: relative;">{{teks_out}}</h4>
	</div>
  </body>

  <script type="text/javascript">
		var fileInput = document.getElementById('image');
		fileInput.onchange = function(){
	  	var base64_data = document.getElementById('base64_data')
			var reader = new FileReader();
			reader.readAsDataURL(fileInput.files[0]);
			reader.onload = function () {
				base64_image = reader.result;
				base64_image = base64_image.replace("data:image/jpg;base64,","")
				base64_image = base64_image.replace("data:image/png;base64,","")
				base64_image = base64_image.replace("data:image/jpeg;base64,","")
				base64_data.value = base64_image
				//console.log(base64_data.value);//base64encoded string
			};
			reader.onerror = function (error) {
				console.log('Error: ', error);
			};		  
		};
		var Sound = (function () {
			var df = document.createDocumentFragment();
			return function Sound(src) {
				var snd = new Audio(src);
				df.appendChild(snd); // keep in fragment until finished playing
				snd.addEventListener('ended', function () {df.removeChild(snd);});
				return snd;
			}
		}());
		// then do it
		var snd = Sound("data:audio/wav;base64," + '{{audio_output}}');
		//var audio = document.getElementById("myImage");
		console.log(snd);
		document.getElementById("audio").src = decoded;
  </script>
</html>